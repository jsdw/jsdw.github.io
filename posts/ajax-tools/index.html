<!doctype html><html><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>
    jsdw - Two Handy Tools to Help Build an AJAX Site
</title><link href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif|Open+Sans" rel=stylesheet><link href=https://jsdw.me/app.css rel=stylesheet><link href=https://jsdw.me/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://jsdw.me/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://jsdw.me/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://jsdw.me/site.webmanifest rel=manifest><link color=#5bbad5 href=https://jsdw.me/safari-pinned-tab.svg rel=mask-icon><meta content=#f9409c name=msapplication-TileColor><meta content=#ffffff name=theme-color><body><div class="body post"><header><div class=title-inner><div class=jsdw><a href=https://jsdw.me>JSDW</a></div><nav><a href=https://jsdw.me/posts/>posts</a><a href=https://jsdw.me/projects/>projects</a></nav></div></header><section><div class=top><div class=top-scene><svg class="polygon two" viewbox="0 0 100 100" height=100% style=fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421 version=1.1 width=100% xml:space=preserve xmlns=http://www.w3.org/2000/svg xmlns:serif=http://www.serif.com/ xmlns:xlink=http://www.w3.org/1999/xlink><polygon points="0 100, 15 40, 60 0, 100 30"/></svg><svg class="polygon one" viewbox="0 0 100 100" height=100% style=fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421 version=1.1 width=100% xml:space=preserve xmlns=http://www.w3.org/2000/svg xmlns:serif=http://www.serif.com/ xmlns:xlink=http://www.w3.org/1999/xlink><polygon points="0 40, 30 0, 80 33, 100 100"/></svg></div><div class=top-inner><h1 class=title>Two Handy Tools to Help Build an AJAX Site <span class=date>2013-06-10</span></h1></div></div><div class=content-inner><div class=post><div class=table-of-contents><ul><li><a href=https://jsdw.me/posts/ajax-tools/#engine-js>Engine.js</a><li><a href=https://jsdw.me/posts/ajax-tools/#state-js>State.js</a><li><a href=https://jsdw.me/posts/ajax-tools/#conclusion>Conclusion</a></ul></div><p>This page introduces two lightweight Javascript tools I have created to aid in the process of creating AJAX heavy websites, <a href=https://jsdw.me/posts/ajax-tools/jw.engine.js>Engine.js</a> for controlling requests for different pages/resources, and <a href=https://jsdw.me/posts/ajax-tools/jw.state.js>State.js</a> for keeping track of the current state of things clientside, and attaching functions to changes in this state. Both are lightweight and relatively simple, so I'll explain by example:<h1 id=engine-js>Engine.js</h1><p><em>Engine.js</em> is used as a clientside routing layer, which acts much like the routing in <em>Express.js</em>, and allows functions to be associated with page requests. In addition, functions not defined under a particular route are executed every time, allowing for initialisation and cleanup code surrounding the specific functionality for each request.<p>The following is a reference combined with example usage:<h2 id=reference>Reference</h2><h3 id=new-engine>new Engine();</h3><pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//create a new routing engine instance (new is optional):
</span><span style=font-style:italic;color:#66d9ef>var </span><span>routes </span><span style=color:#f92672>= new </span><span>Engine();
</span></code></pre><h3 id=engine-add-function1-function2-function3>engine.add(function1, [function2, function3..]);</h3><p>Add a function, or list of functions, that fire for any request made. Functions are all passed two arguments, <code>request</code> and <code>next</code>. The former is an object containing useful information regarding the request made, and the latter is a function that must be called at the end of each function provided in order to execute the next function in the chain.<p>The following example sets up some routes using the <code>add</code> function:<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//called first on every request:
</span><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>req</span><span>, </span><span style=font-style:italic;color:#fd971f>next</span><span>) {
</span><span>	</span><span style=font-style:italic;color:#66d9ef>var </span><span>output </span><span style=color:#f92672>= </span><span>req.output </span><span style=color:#f92672>= </span><span>[];
</span><span>
</span><span>	</span><span style=color:#75715e>//let's look at some variables we have access to:
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"REQUEST"</span><span>);
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"- requested location: " </span><span style=color:#f92672>+ </span><span>req.url);
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"- requested querystring: " </span><span style=color:#f92672>+ </span><span>req.querystring);
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"- passed args: " </span><span style=color:#f92672>+ </span><span>req.args);
</span><span>
</span><span>	</span><span style=color:#75715e>//look at each individual part of query string:
</span><span>	</span><span style=color:#f92672>for</span><span>(</span><span style=font-style:italic;color:#66d9ef>var </span><span>parameter </span><span style=color:#f92672>in </span><span>req.query) {
</span><span>		output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"  o " </span><span style=color:#f92672>+ </span><span>parameter </span><span style=color:#f92672>+ </span><span style=color:#e6db74>": " </span><span style=color:#f92672>+ </span><span>req.query[parameter]);
</span><span>	}
</span><span>
</span><span>	</span><span style=color:#a6e22e>next</span><span>();
</span><span>});
</span><span>
</span><span style=color:#75715e>//only called for routes matching /
</span><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=color:#e6db74>"/"</span><span>, </span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>req</span><span>, </span><span style=font-style:italic;color:#fd971f>next</span><span>) {
</span><span>	</span><span style=font-style:italic;color:#66d9ef>var </span><span>output </span><span style=color:#f92672>= </span><span>req.output;
</span><span>
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"HOME PAGE"</span><span>);
</span><span>
</span><span>	</span><span style=color:#75715e>//returns, firing off the next function in the chain:
</span><span>	</span><span style=color:#f92672>return </span><span style=color:#a6e22e>next</span><span>();
</span><span>});
</span><span>
</span><span style=color:#75715e>//only called for routes matching /stuff/[somevalue1]/[somevalue2]
</span><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=color:#e6db74>"/stuff/{one}/{two}"</span><span>, </span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>req</span><span>, </span><span style=font-style:italic;color:#fd971f>next</span><span>) {
</span><span>	</span><span style=font-style:italic;color:#66d9ef>var </span><span>output </span><span style=color:#f92672>= </span><span>req.output;
</span><span>
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"STUFF"</span><span>);
</span><span>	</span><span style=color:#75715e>//"one" and "two" become variables in an object:
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"- one: " </span><span style=color:#f92672>+ </span><span>req.params.one);
</span><span>	output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"- two: " </span><span style=color:#f92672>+ </span><span>req.params.two);
</span><span>
</span><span>	</span><span style=color:#f92672>return </span><span style=color:#a6e22e>next</span><span>();
</span><span>});
</span><span>
</span><span style=color:#75715e>//called for any route as long as it did not match any of the above
</span><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=color:#e6db74>/</span><span style=color:#ae81ff>.</span><span style=color:#f92672>*</span><span style=color:#e6db74>/</span><span>, </span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>req</span><span>, </span><span style=font-style:italic;color:#fd971f>next</span><span>) {
</span><span>	</span><span style=color:#75715e>//useful as a catchall route (ie an error 404):
</span><span>	req.output.</span><span style=color:#66d9ef>push</span><span>(</span><span style=color:#e6db74>"PAGE NOT FOUND"</span><span>);
</span><span>
</span><span>	</span><span style=color:#75715e>//passing variable to next sets req.error to it:
</span><span>	</span><span style=color:#a6e22e>next</span><span>(</span><span style=color:#e6db74>"location "</span><span style=color:#f92672>+</span><span>req.url</span><span style=color:#f92672>+</span><span style=color:#e6db74>" does not exist"</span><span>);
</span><span>});
</span><span>
</span><span style=color:#75715e>//called last on every request:
</span><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>req</span><span>, </span><span style=font-style:italic;color:#fd971f>next</span><span>) {
</span><span>	</span><span style=color:#f92672>if</span><span>(req.error) </span><span style=font-style:italic;color:#66d9ef>console</span><span>.</span><span style=color:#66d9ef>log</span><span>(</span><span style=color:#e6db74>"ERROR: " </span><span style=color:#f92672>+ </span><span>req.error);
</span><span>	</span><span style=color:#f92672>else </span><span style=font-style:italic;color:#66d9ef>console</span><span>.</span><span style=color:#66d9ef>log</span><span>(req.output.</span><span style=color:#66d9ef>join</span><span>(</span><span style=color:#e6db74>"</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>"</span><span>));
</span><span>
</span><span>	</span><span style=color:#75715e>//we'd need a next() here if there was another function following this.
</span><span>});
</span></code></pre><h3 id=engine-go-path-optional-arguments>engine.go(path, [optional arguments]);</h3><p>Execute any functions valid given the string <code>path</code>, passing any additional arguments to these functions as an <code>args</code> array stored in the <code>request</code> object provided to each function.<p>Here is the console output for a few example requests, given the routes defined above:<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span>
</span><span>routes.</span><span style=color:#66d9ef>go</span><span>(</span><span style=color:#e6db74>"/"</span><span>);
</span><span style=color:#75715e>/*
</span><span style=color:#75715e>REQUEST
</span><span style=color:#75715e>- requested location: /
</span><span style=color:#75715e>- requested querystring:
</span><span style=color:#75715e>- passed args:
</span><span style=color:#75715e>HOME PAGE
</span><span style=color:#75715e>*/
</span><span>
</span><span>routes.</span><span style=color:#66d9ef>go</span><span>(</span><span style=color:#e6db74>"/"</span><span>, </span><span style=color:#ae81ff>true</span><span>, </span><span style=color:#ae81ff>1</span><span>, </span><span style=color:#e6db74>"something"</span><span>);
</span><span style=color:#75715e>/*
</span><span style=color:#75715e>REQUEST
</span><span style=color:#75715e>- requested location: /
</span><span style=color:#75715e>- requested querystring:
</span><span style=color:#75715e>- passed args: true,1,something
</span><span style=color:#75715e>HOME PAGE
</span><span style=color:#75715e>*/
</span><span>
</span><span>routes.</span><span style=color:#66d9ef>go</span><span>(</span><span style=color:#e6db74>"/?zoo=1&too=2"</span><span>);
</span><span style=color:#75715e>/*
</span><span style=color:#75715e>REQUEST
</span><span style=color:#75715e>- requested location: /
</span><span style=color:#75715e>- requested querystring: zoo=1&too=2
</span><span style=color:#75715e>  o zoo: 1
</span><span style=color:#75715e>  o too: 2
</span><span style=color:#75715e>- passed args:
</span><span style=color:#75715e>HOME PAGE
</span><span style=color:#75715e>*/
</span><span>
</span><span>routes.</span><span style=color:#66d9ef>go</span><span>(</span><span style=color:#e6db74>"/randompage/something"</span><span>);
</span><span style=color:#75715e>/*
</span><span style=color:#75715e>ERROR: location /randompage/something does not exist
</span><span style=color:#75715e>*/
</span><span>
</span><span>routes.</span><span style=color:#66d9ef>go</span><span>(</span><span style=color:#e6db74>"/stuff/bam/another"</span><span>);
</span><span style=color:#75715e>/*
</span><span style=color:#75715e>REQUEST
</span><span style=color:#75715e>- requested location: /stuff/bam/another
</span><span style=color:#75715e>- requested querystring:
</span><span style=color:#75715e>- passed args:
</span><span style=color:#75715e>STUFF
</span><span style=color:#75715e>- one: bam
</span><span style=color:#75715e>- two: another
</span><span style=color:#75715e>*/
</span></code></pre><h2 id=more-information>More Information</h2><p>These examples build a pretty decent picture up of what is going on. The first parameter passed to each routing function is the <em>request</em> object, which contains some useful information (including the location asked for, querystring, and any arguments passed to <code>routes.go</code> after the location). The second parameter is the <code>next</code> function, and should be called when the routing function has finished, in order to fire off the next routing function. A route can also have a list of functions added for it, to help reusability, such as:<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span>routes.</span><span style=color:#66d9ef>add</span><span>(</span><span style=color:#e6db74>"/somepath"</span><span>, function1, function2, function3);
</span></code></pre><p>Another thing worth noting, is that anything you add to the <em>request</em> object is present in later function calls as well, so it's handy for passing things through the function chain as I have done with <code>req.output</code> in order to build up an output string.<p>The querystring (anything after the first "?" in the request) is parsed for your convenience, and also added to the request object in both its original and parsed form; it does not influence the routing process at all. In addition, routes themselves can contain variables, as we can see from the use of the <code>/stuff/{one}/{two}</code> route, where a variable is any word enclosed in curly braces. These are then accessible in <code>req.params</code>, in the above case <code>req.params.one</code> and <code>req.params.two</code>.<h3 id=automating-things>Automating Things</h3><p>Once we have defined routes, it's often useful to set the routing engine up to handle changes to the document URL automatically. One major benefit of this is that it preserves browser history. To do this, we just need to set up an interval timer to check for changes to the URL, and pass any changes to the routing engine. Following from the above examples, this could be achieved as follows:<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span>(</span><span style=font-style:italic;color:#66d9ef>function</span><span>() {
</span><span>	</span><span style=font-style:italic;color:#66d9ef>var </span><span>old_hash </span><span style=color:#f92672>= </span><span>window.location.hash;
</span><span>	</span><span style=font-style:italic;color:#66d9ef>function </span><span style=color:#a6e22e>check</span><span>() {
</span><span>		</span><span style=color:#f92672>if</span><span>(window.location.hash </span><span style=color:#f92672>!== </span><span>old_hash) {
</span><span>			old_hash </span><span style=color:#f92672>= </span><span>window.location.hash;
</span><span>			routes.</span><span style=color:#66d9ef>go</span><span>(old_hash.</span><span style=color:#66d9ef>replace</span><span>(</span><span style=color:#e6db74>/</span><span style=color:#f92672>^</span><span style=color:#e6db74>#!</span><span style=color:#f92672>?</span><span style=color:#e6db74>/</span><span>, </span><span style=color:#e6db74>""</span><span>));
</span><span>		}
</span><span>	}
</span><span>	</span><span style=font-style:italic;color:#66d9ef>var </span><span>interval </span><span style=color:#f92672>= </span><span style=color:#66d9ef>setInterval</span><span>(check, </span><span style=color:#ae81ff>100</span><span>);
</span><span>})();
</span></code></pre><p>This anonymous function just checks the value of the URL hash string (everything including and after the "#" symbol in the current URL), and passes any such changes to the routing engine. Given this, you simply point links in your page to <code>#[YOUR_ROUTE]</code> to have the routing functionality kick in and perform whatever is necessary for the given route.<h1 id=state-js>State.js</h1><p><em>State.js</em> is a simple utility for managing the <em>state</em> of variables clientside. Since AJAX heavy pages do no completely reload on each request, maintaining the correct state of the page relies on decent routing functionality (see above for that), as well as ensuring that any state changes that occur are centralized and acted on appropriately.<p>For example, if user login/logout is handled via AJAX, items in the page such as a display showing the name of the logged in user need to be responsive to the change in this status. In more complex applications, requests may be able to change the value of numerous values on the server, and these values need to be kept in sync with those shown clientside.<p><em>State.js</em> is simply an implementation of a storage mechanism for variables, which allows for a hierarchical storage of variables, and allows functions to be attached to any such locations, to ensure that changes to the variables are properly handled.<p>Thw following is a reference combined with example usage:<h2 id=reference-1>Reference</h2><h3 id=new-state-start-state>new State([start_state]);</h3><pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//create a new instance of State (new prefix is optional):
</span><span style=font-style:italic;color:#66d9ef>var </span><span>s </span><span style=color:#f92672>= new </span><span>State();
</span></code></pre><p>Optionally, if an argument is passed in to <code>new State</code>, it is used as the inital state.<h3 id=state-setvalue-path-value>state.setValue(path, value);</h3><p>Sets the value at the string <code>path</code> to the value <code>value</code>, where <code>path</code> is a period separated location.<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//set a basic path to a value:
</span><span>s.</span><span style=color:#a6e22e>setValue</span><span>(</span><span style=color:#e6db74>"hello"</span><span>, </span><span style=color:#ae81ff>200</span><span>);
</span><span>
</span><span style=color:#75715e>//set a compound path to a value:
</span><span>s.</span><span style=color:#a6e22e>setValue</span><span>(</span><span style=color:#e6db74>"list.one"</span><span>, </span><span style=color:#e6db74>"A"</span><span>);
</span><span>s.</span><span style=color:#a6e22e>setValue</span><span>(</span><span style=color:#e6db74>"list.two"</span><span>, </span><span style=color:#e6db74>"B"</span><span>);
</span><span>
</span><span style=color:#75715e>//set a path to a number of values:
</span><span>s.</span><span style=color:#a6e22e>setValue</span><span>(</span><span style=color:#e6db74>"another_list"</span><span>, {three: </span><span style=color:#e6db74>"C"</span><span>, four: </span><span style=color:#e6db74>"D"</span><span>});
</span><span>
</span><span style=color:#75715e>//set every value simultaneously:
</span><span>s.</span><span style=color:#a6e22e>setValue</span><span>({
</span><span>	hello: </span><span style=color:#ae81ff>200</span><span>,
</span><span>	list: {
</span><span>		one: </span><span style=color:#e6db74>"A"</span><span>,
</span><span>		two: </span><span style=color:#e6db74>"B"
</span><span>	},
</span><span>	another_list: {
</span><span>		three: </span><span style=color:#e6db74>"C"</span><span>,
</span><span>		four: </span><span style=color:#e6db74>"D"
</span><span>	}
</span><span>});
</span></code></pre><p>Worth noting here is that objects and paths are interchangeable; paths are internally converted into objects to allow for the above.<h3 id=state-getvalue-path>state.getValue(path)</h3><p>Gets a <strong>copy</strong> of the value stored at the string <code>path</code>.<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//carrying on from the examples above.
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>"list"</span><span>); </span><span style=color:#75715e>//returns object {one: "A", two: "B"}
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>".list"</span><span>); </span><span style=color:#75715e>//returns object {one: "A", two: "B"}
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>"list.one"</span><span>); </span><span style=color:#75715e>//returns "A"
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>".list.one"</span><span>); </span><span style=color:#75715e>//returns "A"
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>"something.blah"</span><span>); </span><span style=color:#75715e>//any unset path returns undefined.
</span><span>
</span><span style=color:#75715e>//returns object containing everything:
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>();
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>""</span><span>);
</span><span>s.</span><span style=color:#a6e22e>getValue</span><span>(</span><span style=color:#e6db74>"."</span><span>);
</span></code></pre><h3 id=state-setfunction-path-func>state.setFunction(path, func);</h3><p>Sets a function <code>func</code> to execute whenever the value stored at the string <code>path</code> changes. <code>func</code> received three arguments, <code>old_value</code> (the previous value at that path), <code>new_value</code> (the new value at that path) and a string equal to <code>path</code>.<p>If path is an object, sets any function stored within the object to fire when the path equal to that functions location in the object is changed.<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=font-style:italic;color:#66d9ef>var </span><span style=color:#a6e22e>f </span><span style=color:#f92672>= </span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>old_val</span><span>, </span><span style=font-style:italic;color:#fd971f>new_val</span><span>, </span><span style=font-style:italic;color:#fd971f>path</span><span>) {
</span><span>	</span><span style=font-style:italic;color:#66d9ef>console</span><span>.</span><span style=color:#66d9ef>log</span><span>(path </span><span style=color:#f92672>+</span><span style=color:#e6db74>": "</span><span style=color:#f92672>+</span><span>old_val</span><span style=color:#f92672>+</span><span style=color:#e6db74>" -> "</span><span style=color:#f92672>+</span><span>new_val);
</span><span>}
</span><span>
</span><span style=color:#75715e>//basic function setting:
</span><span>s.</span><span style=color:#a6e22e>setFunction</span><span>(</span><span style=color:#e6db74>"hello"</span><span>, f);
</span><span>
</span><span style=color:#75715e>//set function to fire when anything under "list" changes:
</span><span>s.</span><span style=color:#a6e22e>setFunction</span><span>(</span><span style=color:#e6db74>"list"</span><span>, </span><span style=font-style:italic;color:#66d9ef>function</span><span>(</span><span style=font-style:italic;color:#fd971f>old_val</span><span>, </span><span style=font-style:italic;color:#fd971f>new_val</span><span>, </span><span style=font-style:italic;color:#fd971f>path</span><span>) {
</span><span>	</span><span style=color:#75715e>//log values at "list" when any of them change:
</span><span>	</span><span style=color:#f92672>if</span><span>(</span><span style=color:#f92672>typeof </span><span>new_val </span><span style=color:#f92672>== </span><span style=color:#e6db74>"object"</span><span>) </span><span style=color:#f92672>for</span><span>(</span><span style=font-style:italic;color:#66d9ef>var </span><span>i </span><span style=color:#f92672>in </span><span>new_val) {
</span><span>		</span><span style=font-style:italic;color:#66d9ef>console</span><span>.</span><span style=color:#66d9ef>log</span><span>(i </span><span style=color:#f92672>+ </span><span style=color:#e6db74>": " </span><span style=color:#f92672>+ </span><span>new_val[i]);
</span><span>	} </span><span style=color:#f92672>else </span><span>{
</span><span>		</span><span style=font-style:italic;color:#66d9ef>console</span><span>.</span><span style=color:#66d9ef>log</span><span>(new_val);
</span><span>	}
</span><span>});
</span><span>
</span><span style=color:#75715e>//sets a bunch of paths to the function f:
</span><span>s.</span><span style=color:#a6e22e>setFunction</span><span>({ another_list: {three: f, four: f, five: f}, random: f});
</span><span>
</span><span style=color:#75715e>//set two functions under a given path to function f:
</span><span>s.</span><span style=color:#a6e22e>setFunction</span><span>(</span><span style=color:#e6db74>"list"</span><span>, {one: f, two: f});
</span></code></pre><h3 id=state-removefunction-path-path2>state.removeFunction(path, [path2]);</h3><p>Removes the function linked to the path <code>path</code>. If <code>path</code> is an object, all functions at paths present in the object are removed. If <code>path2</code> is present and is an object, all functions at paths in <code>path2</code> prefixed with path are removed.<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//remove function at "list":
</span><span>s.</span><span style=color:#a6e22e>removeFunction</span><span>(</span><span style=color:#e6db74>"list"</span><span>);
</span><span>
</span><span style=color:#75715e>//remove functions at "list" and "hello":
</span><span>s.</span><span style=color:#a6e22e>removeFunction</span><span>({list:</span><span style=color:#ae81ff>1</span><span>, hello:</span><span style=color:#ae81ff>1</span><span>});
</span><span>
</span><span style=color:#75715e>//remove functions "list.one", "list.two", "list.another.three":
</span><span>s.</span><span style=color:#a6e22e>removeFunction</span><span>(</span><span style=color:#e6db74>"list"</span><span>, {one:</span><span style=color:#ae81ff>1</span><span>, two:</span><span style=color:#ae81ff>2</span><span>, another:{three:</span><span style=color:#ae81ff>1</span><span>} });
</span></code></pre><h3 id=state-triggerfunction-path>state.triggerFunction(path);</h3><p>Executes the function linked to the path <code>path</code>. The function is passed the value at that path twice (in place of the old and new values sent to it ordinarily) as well as the path it is called from.<pre class=language-javascript data-lang=javascript style=background:#272822;color:#f8f8f2><code class=language-javascript data-lang=javascript><span style=color:#75715e>//trigger the function held at "list.one":
</span><span>s.</span><span style=color:#a6e22e>triggerFunction</span><span>(</span><span style=color:#e6db74>"list.one"</span><span>);
</span></code></pre><h2 id=more-information-1>More Information</h2><p>Functions triggered either with <code>triggerFunction</code> or by a change in the state are each passed a copy of the old and new value at that path. This means that you can reassign/reuse the parameters passed in to functions freely, without having to worry about where else they may be referenced. This comes at a small overhead cost equating to needing to copy any values found to have changed if there exists a function or functions triggered by that change.<p>As such, maintaining a very large set of values in the state, and making frequent changes to them, will result in a significant amount of copying of variables. I have deemed this worthwhile however in order to make the entire system more robust, and give the end user less to worry about.<h1 id=conclusion>Conclusion</h1><p>I have introduced two utilities developed to help manage my AJAX heavy website, and modified for public consumption. If you have plans to use a lot of AJAX in your site, I encourage you to take a look and see if they can save you some time! Download links:<ul><li><a href=https://jsdw.me/posts/ajax-tools/jw.engine.js>Engine.js</a> for route management.<li><a href=https://jsdw.me/posts/ajax-tools/jw.state.js>State.js</a> for variable management.</ul><p>If you find any issues, or otherwise have any suggestions or comments, give me a shout!</div></div></section><footer></footer></div><script src=https://jsdw.me/page.js></script>